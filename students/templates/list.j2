{% extends 'base.j2' %}
{% block content %}
{% load static %}
{% if request.user.is_authenticated %}
<ul>
<h2>{{ request.user.username }}</h2>
<ul>
{% for i in user %}
    <li id=user-{{ i.id }}><a href="{% url 'user_view' i.username %}" target="_blank">{{ i.username }}</a></li>
{% endfor %}
</ul>

<div id='data-container'>
</div>

 <script>

        $(document).ready(function() {
        function fetchData() {
            $.ajax({
                url: 'http://127.0.0.1:8000/api/users/',
                method: 'GET',
                success: function(data) {
                    let results = data;
                        let html = '<ul>';
                        results.forEach(function(item) {
                            html += '<li> Name: ' + item.username + '</li>';
                        });
                        html += '</ul>';
                        $('#data-container').html(html);
                },
                error: function(error) {
                    $('#data-container').html('Error: ' + error.statusText);
                }
            });
        }

        fetchData();setInterval(fetchData, 5000);
        });
    </script>


{% endif %}


{% endblock %}
